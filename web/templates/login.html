{{template "base" .}}

{{define "content"}}
<div class="auth-page" style="margin-top:0;min-height:100vh">
  <div class="auth-card">
    <div class="auth-logo">
      <div class="auth-logo-text">Team TransMTF</div>
    </div>
    <h2 class="auth-title">Sign In</h2>

    {{if .Flash}}
    <div class="flash {{if .IsError}}flash-err{{else}}flash-ok{{end}}">
      {{.Flash}}
      {{with .Data}}{{if .UnverifiedEmail}}
      <br>
      <a href="/verify-email?email={{.UnverifiedEmail | urlEncode}}" style="font-size:.85rem;text-decoration:underline">
        Resend verification email
      </a>
      {{end}}{{end}}
    </div>
    {{end}}

    {{with .Data}}
    {{if .Providers}}
    <div style="display:flex;flex-direction:column;gap:.6rem;margin-bottom:1.2rem">
      {{range .Providers}}
      <a class="btn btn-ghost" style="justify-content:center;gap:.6rem"
         href="/auth/oidc/{{.Slug}}{{if $.Data}}{{with $.Data}}{{if .Next}}?next={{.Next | urlEncode}}{{end}}{{end}}{{end}}">
        {{if .Icon}}<span>{{.Icon}}</span>{{end}}
        Continue with {{.Name}}
      </a>
      {{end}}
    </div>
    <div style="display:flex;align-items:center;gap:.8rem;margin-bottom:1.2rem">
      <div style="flex:1;height:1px;background:rgba(255,255,255,.12)"></div>
      <span style="font-size:.8rem;color:#666">or email login</span>
      <div style="flex:1;height:1px;background:rgba(255,255,255,.12)"></div>
    </div>
    {{end}}
    {{end}}

    <form method="POST" action="/login">
      <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
      {{with .Data}}{{if .Next}}<input type="hidden" name="next" value="{{.Next}}">{{end}}{{end}}
      <div class="form-group">
        <label class="form-label">Email</label>
        <input class="form-control" type="email" name="email" placeholder="you@example.com" required autofocus>
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input class="form-control" type="password" name="password" placeholder="Enter your password" required>
      </div>
      <button class="btn btn-primary" style="width:100%;justify-content:center;margin-top:.5rem" type="submit">Sign In</button>
    </form>

    <p style="text-align:right;font-size:.85rem;margin-top:.6rem">
      <a href="/forgot-password">Forgot password?</a>
    </p>

    <div style="display:flex;align-items:center;gap:.8rem;margin:1rem 0">
      <div style="flex:1;height:1px;background:rgba(128,128,128,.2)"></div>
      <span style="font-size:.8rem;color:#888">or</span>
      <div style="flex:1;height:1px;background:rgba(128,128,128,.2)"></div>
    </div>

    <button id="primary-passkey-login-btn" class="btn btn-ghost" style="width:100%;justify-content:center;gap:.5rem" type="button">
      <span>PK</span> Sign in with Passkey
    </button>
    <div id="primary-passkey-login-msg" style="font-size:.85rem;color:#dc2626;margin-top:.4rem;display:none"></div>

    <p class="auth-footer-link">No account yet? <a href="/register">Create one</a></p>
  </div>
</div>
<script src="/static/js/passkey-login.js"></script>
{{end}}

