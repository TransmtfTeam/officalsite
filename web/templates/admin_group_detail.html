{{template "base" .}}

{{define "content"}}
<div class="panel-wrap">
  <aside class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-title">ç®¡ç†å¯¼èˆª</div>
      {{if .CurrentUser.IsAdmin}}
      <a class="sidebar-link" href="/admin">æ¦‚è§ˆ</a>
      <a class="sidebar-link" href="/admin/users">ç”¨æˆ·</a>
      {{end}}
      <a class="sidebar-link active" href="/admin/groups">åˆ†ç»„</a>
      <a class="sidebar-link" href="/admin/clients">åº”ç”¨</a>
      {{if .CurrentUser.IsAdmin}}
      <a class="sidebar-link" href="/admin/providers">ç™»å½•æ–¹å¼</a>
      <a class="sidebar-link" href="/admin/roles">è§’è‰²</a>
      <a class="sidebar-link" href="/admin/announcements">å…¬å‘Š</a>
      <a class="sidebar-link" href="/admin/settings">è®¾ç½®</a>
      {{end}}
    </div>
    <div class="sidebar-section">
      <div class="sidebar-title">å¿«é€Ÿå…¥å£</div>
      <a class="sidebar-link" href="/">è¿”å›é¦–é¡µ</a>
      <a class="sidebar-link" href="/profile">ä¸ªäººèµ„æ–™</a>
      <a class="sidebar-link" href="/member/projects">ç¤¾åŒºé¡¹ç›®</a>
    </div>
  </aside>

  <main class="panel-content">
    {{with .Data}}
    {{$group   := index . "Group"}}
    {{$members := index . "Members"}}
    {{$users   := index . "Users"}}

    <div style="margin-bottom:.5rem">
      <a href="/admin/groups" style="color:var(--text2);font-size:.9rem">â† åˆ†ç»„åˆ—è¡¨</a>
    </div>

    {{if $.Flash}}
    <div class="flash {{if $.IsError}}flash-err{{else}}flash-ok{{end}}">{{$.Flash}}</div>
    {{end}}

    <h1 class="panel-title">{{if $group.Label}}{{$group.Label}}{{else}}{{$group.Name}}{{end}}</h1>
    <p class="panel-sub">åˆ†ç»„æ ‡è¯†ï¼š<code class="mono">{{$group.Name}}</code></p>

    {{/* â”€â”€ æ·»åŠ æˆå‘˜ â”€â”€ */}}
    <div class="form-panel">
      <p class="form-panel-title">æ·»åŠ æˆå‘˜</p>
      <form method="POST" action="/admin/groups/{{$group.ID}}/add-member" style="display:flex;gap:.8rem;align-items:flex-end;flex-wrap:wrap">
        <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
        <div class="form-group" style="flex:1;min-width:200px;margin-bottom:0">
          <label class="form-label">é€‰æ‹©ç”¨æˆ·</label>
          <select class="form-control" name="user_id" required>
            <option value="">è¯·é€‰æ‹©ç”¨æˆ·</option>
            {{range $users}}
            <option value="{{.ID}}">{{.DisplayName}} ({{.Email}})</option>
            {{end}}
          </select>
        </div>
        <button class="btn btn-primary btn-sm" type="submit">æ·»åŠ </button>
      </form>
    </div>

    {{/* â”€â”€ æˆå‘˜åˆ—è¡¨ â”€â”€ */}}
    <div class="card">
      <table class="data-table">
        <thead>
          <tr>
            <th>é‚®ç®±</th>
            <th>æ˜¾ç¤ºåç§°</th>
            <th>è§’è‰²</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          {{range $members}}
          <tr>
            <td>{{.Email}}</td>
            <td>{{.DisplayName}}</td>
            <td>
              <span class="role-badge {{if eq .Role "admin"}}role-admin{{else if eq .Role "member"}}role-member{{else}}role-user{{end}}">
                {{if eq .Role "admin"}}admin{{else if eq .Role "member"}}member{{else if eq .Role "user"}}user{{else}}{{.Role}}{{end}}
              </span>
            </td>
            <td>
              <form method="POST" action="/admin/groups/{{$group.ID}}/members/{{.ID}}/remove">
                <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
                <button class="btn btn-danger btn-sm" type="submit"
                  data-confirm="ç¡®è®¤å°†æ­¤ç”¨æˆ·ç§»å‡ºåˆ†ç»„å—ï¼Ÿ"
                  data-confirm-title="ç§»å‡ºåˆ†ç»„" data-confirm-icon="ğŸ‘¤">ç§»å‡º</button>
              </form>
            </td>
          </tr>
          {{else}}
          <tr><td colspan="4" style="color:var(--text2);text-align:center;padding:2rem">è¯¥åˆ†ç»„æš‚æ— æˆå‘˜</td></tr>
          {{end}}
        </tbody>
      </table>
    </div>
    {{end}}
  </main>
</div>
{{end}}
