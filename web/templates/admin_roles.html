{{template "base" .}}

{{define "content"}}
<div class="panel-wrap">
  <aside class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-title">ç®¡ç†å¯¼èˆª</div>
      <a class="sidebar-link" href="/admin">æ¦‚è§ˆ</a>
      <a class="sidebar-link" href="/admin/users">ç”¨æˆ·</a>
      <a class="sidebar-link" href="/admin/groups">åˆ†ç»„</a>
      <a class="sidebar-link" href="/admin/clients">åº”ç”¨</a>
      <a class="sidebar-link" href="/admin/providers">ç™»å½•æ–¹å¼</a>
      <a class="sidebar-link active" href="/admin/roles">è§’è‰²</a>
      <a class="sidebar-link" href="/admin/announcements">å…¬å‘Š</a>
      <a class="sidebar-link" href="/admin/settings">è®¾ç½®</a>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-title">å¿«é€Ÿå…¥å£</div>
      <a class="sidebar-link" href="/">è¿”å›é¦–é¡µ</a>
      <a class="sidebar-link" href="/profile">ä¸ªäººèµ„æ–™</a>
      <a class="sidebar-link" href="/member/projects">ç¤¾åŒºé¡¹ç›®</a>
    </div>
  </aside>

  <main class="panel-content">
    <h1 class="panel-title">è§’è‰²ç®¡ç†</h1>
    <p class="panel-sub">
      ä¸‰ä¸ªå†…ç½®è§’è‰²ï¼ˆuser / member / adminï¼‰ä¸å¯åˆ é™¤ã€‚å¯ä»¥åœ¨æ­¤åˆ›å»ºè‡ªå®šä¹‰è§’è‰²å¹¶åˆ†é…ç«™ç‚¹æƒé™ã€‚
    </p>

    {{if .Flash}}
    <div class="flash {{if .IsError}}flash-err{{else}}flash-ok{{end}}">{{.Flash}}</div>
    {{end}}

    {{with .Data}}
    {{$perms := index . "Permissions"}}

    <div class="form-panel">
      <p class="form-panel-title">åˆ›å»ºè‡ªå®šä¹‰è§’è‰²</p>
      <form method="POST" action="/admin/roles">
        <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">è§’è‰²åï¼ˆä»…å°å†™å­—æ¯ã€æ•°å­—ã€-ï¼‰</label>
            <input class="form-control" type="text" name="name" placeholder="è¯·è¾“å…¥è§’è‰²ä»£å·" required pattern="[a-z0-9\-]+">
          </div>
          <div class="form-group">
            <label class="form-label">æ˜¾ç¤ºæ ‡ç­¾ï¼ˆå¯é€‰ï¼‰</label>
            <input class="form-control" type="text" name="label" placeholder="ç¼–è¾‘å‘˜">
          </div>
        </div>
        <div class="form-group" style="margin-top:.4rem">
          <label class="form-label">ç«™ç‚¹æƒé™</label>
          <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:.5rem .8rem;margin-top:.4rem">
            {{range $perms}}
            <label style="display:flex;align-items:flex-start;gap:.5rem;cursor:pointer;padding:.45rem .6rem;border-radius:8px;border:1px solid rgba(0,0,0,0.08);background:rgba(255,255,255,0.5)">
              <input type="checkbox" name="permissions" value="{{index . "name"}}" style="margin-top:.15rem;flex-shrink:0">
              <span>
                <span style="font-size:.88rem;font-weight:600;color:var(--text)">{{index . "label"}}</span><br>
                <span style="font-size:.78rem;color:var(--text2)">{{index . "desc"}}</span>
              </span>
            </label>
            {{end}}
          </div>
        </div>
        <button class="btn btn-primary btn-sm" type="submit" style="margin-top:.8rem">åˆ›å»ºè§’è‰²</button>
      </form>
    </div>

    <div class="card">
      <p style="font-size:.85rem;font-weight:600;color:var(--text2);margin-bottom:.8rem">å†…ç½®è§’è‰²</p>
      <table class="data-table" style="margin-bottom:1.5rem">
        <thead><tr><th>è§’è‰²å</th><th>è¯´æ˜</th><th>æƒé™</th></tr></thead>
        <tbody>
          <tr>
            <td><span class="role-badge role-user">user</span></td>
            <td style="font-size:.88rem;color:var(--text2)">æ™®é€šæ³¨å†Œç”¨æˆ·</td>
            <td style="font-size:.8rem;color:var(--text2)">ç™»å½•ã€ä¸ªäººèµ„æ–™ã€æˆæƒç¡®è®¤</td>
          </tr>
          <tr>
            <td><span class="role-badge role-member">member</span></td>
            <td style="font-size:.88rem;color:var(--text2)">å›¢é˜Ÿæˆå‘˜</td>
            <td style="font-size:.8rem;color:var(--text2)">ç®¡ç†é¡¹ç›® Â· ç®¡ç†åº”ç”¨ Â· ç®¡ç†å…¬å‘Š</td>
          </tr>
          <tr>
            <td><span class="role-badge role-admin">admin</span></td>
            <td style="font-size:.88rem;color:var(--text2)">ç®¡ç†å‘˜</td>
            <td style="font-size:.8rem;color:var(--text2)">å…¨éƒ¨æƒé™</td>
          </tr>
        </tbody>
      </table>

      <p style="font-size:.85rem;font-weight:600;color:var(--text2);margin-bottom:.8rem">è‡ªå®šä¹‰è§’è‰²</p>
      <table class="data-table">
        <thead><tr><th>è§’è‰²å</th><th>æ ‡ç­¾</th><th>å·²åˆ†é…æƒé™</th><th>åˆ›å»ºæ—¶é—´</th><th>æ“ä½œ</th></tr></thead>
        <tbody>
          {{range index . "Roles"}}
          <tr>
            <td><span class="role-badge role-user">{{.Name}}</span></td>
            <td>{{if .Label}}{{.Label}}{{else}}<span style="color:var(--text2)">ï¼ˆæ— ï¼‰</span>{{end}}</td>
            <td style="font-size:.8rem">
              {{if .Permissions}}
                {{range .Permissions}}<span class="proj-tag">{{.}}</span> {{end}}
              {{else}}
                <span style="color:var(--text2)">ï¼ˆæ— æƒé™ï¼‰</span>
              {{end}}
            </td>
            <td>{{.CreatedAt.Format "2006-01-02"}}</td>
            <td>
              <form method="POST" action="/admin/roles/{{.Name}}/delete">
                <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
                <button class="btn btn-danger btn-sm" type="submit"
                  data-confirm="ç¡®è®¤åˆ é™¤æ­¤è§’è‰²å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚" data-confirm-title="åˆ é™¤è§’è‰²" data-confirm-icon="ğŸ—‘ï¸">åˆ é™¤</button>
              </form>
            </td>
          </tr>
          {{else}}
          <tr><td colspan="5" style="color:var(--text2);text-align:center;padding:1.5rem">æš‚æ— è‡ªå®šä¹‰è§’è‰²</td></tr>
          {{end}}
        </tbody>
      </table>
    </div>
    {{end}}
  </main>
</div>
{{end}}
