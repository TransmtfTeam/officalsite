{{template "base" .}}

{{define "content"}}
<div class="auth-page" style="margin-top:0;min-height:100vh">
  <div class="auth-card">
    <div class="auth-logo">
      <div class="auth-logo-text">{{.SiteName}}</div>
    </div>
    <h2 class="auth-title">首次使用外部登录</h2>

    {{with .Data}}
    <div style="display:flex;align-items:center;justify-content:center;gap:.6rem;margin-bottom:1rem">
      {{$svg := providerIconSVG .ProviderSlug ""}}
      {{if $svg}}<span class="provider-icon" style="width:24px;height:24px">{{$svg}}</span>{{end}}
      <strong>{{.ProviderName}}</strong>
    </div>

    <p style="font-size:.9rem;color:var(--text2);line-height:1.7;margin-bottom:1rem">
      你正在使用 {{.ProviderName}} 登录。请选择接下来的方式：
    </p>

    {{if .ProfileAvatar}}
    <div style="display:flex;justify-content:center;margin-bottom:.8rem">
      <img src="{{.ProfileAvatar}}" alt="外部头像" style="width:54px;height:54px;border-radius:999px;border:1px solid rgba(0,0,0,.08);object-fit:cover">
    </div>
    {{end}}
    {{if .ProfileName}}
    <p style="text-align:center;font-size:.86rem;color:var(--text2);margin-bottom:1rem">外部昵称：{{.ProfileName}}</p>
    {{end}}
    {{if .ProfileEmail}}
    <p style="text-align:center;font-size:.86rem;color:var(--text2);margin-bottom:1rem">外部邮箱：{{.ProfileEmail}}</p>
    {{end}}

    <form method="POST" action="/auth/oidc/first-login" style="display:flex;flex-direction:column;gap:.7rem">
      <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
      <input type="hidden" name="challenge" value="{{.Challenge}}">
      <button class="btn btn-primary" type="submit" name="action" value="bind" style="justify-content:center">
        绑定已有账户
      </button>
      <button class="btn btn-ghost" type="submit" name="action" value="register" style="justify-content:center">
        注册新账户
      </button>
    </form>
    {{end}}
  </div>
</div>
{{end}}
