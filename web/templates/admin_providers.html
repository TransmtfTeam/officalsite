{{template "base" .}}

{{define "content"}}
<div class="panel-wrap">
  <aside class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-title">ç®¡ç†å¯¼èˆª</div>
      <a class="sidebar-link" href="/admin">æ¦‚è§ˆ</a>
      <a class="sidebar-link" href="/admin/users">ç”¨æˆ·</a>
      <a class="sidebar-link" href="/admin/groups">åˆ†ç»„</a>
      <a class="sidebar-link" href="/admin/clients">åº”ç”¨</a>
      <a class="sidebar-link active" href="/admin/providers">ç™»å½•æ–¹å¼</a>
      <a class="sidebar-link" href="/admin/roles">è§’è‰²</a>
      <a class="sidebar-link" href="/admin/announcements">å…¬å‘Š</a>
      <a class="sidebar-link" href="/admin/settings">è®¾ç½®</a>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-title">å¿«é€Ÿå…¥å£</div>
      <a class="sidebar-link" href="/">è¿”å›é¦–é¡µ</a>
      <a class="sidebar-link" href="/profile">ä¸ªäººèµ„æ–™</a>
    </div>
  </aside>

  <main class="panel-content">
    <h1 class="panel-title">å¤–éƒ¨ç™»å½•æ–¹å¼</h1>
    <p class="panel-sub">é…ç½®æ ‡å‡† OIDC æä¾›å•†ï¼ˆä¾‹å¦‚ Xã€Googleã€Keycloakï¼‰ï¼Œç”¨äºä¸€é”®ç™»å½•ã€‚</p>

    {{if .Flash}}
    <div class="flash {{if .IsError}}flash-err{{else}}flash-ok{{end}}">{{.Flash}}</div>
    {{end}}

    <div class="form-panel">
      <p class="form-panel-title">æ–°å¢æä¾›å•†</p>
      <p style="font-size:.82rem;color:#888;margin-bottom:1rem">
        å›è°ƒåœ°å€è¯·å¡«å†™ä¸ºï¼š<code style="color:var(--blue)">{{.Issuer}}/auth/oidc/{slug}/callback</code>
      </p>
      <form method="POST" action="/admin/providers">
        <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">åç§°ï¼ˆå±•ç¤ºç”¨ï¼‰</label>
            <input class="form-control" type="text" name="name" placeholder="X / Google / Keycloak" required>
          </div>
          <div class="form-group">
            <label class="form-label">Slugï¼ˆURL è·¯å¾„ï¼‰</label>
            <input class="form-control" type="text" name="slug" placeholder="twitter" pattern="[a-z0-9\-]+" required>
          </div>
          <div class="form-group">
            <label class="form-label">å›¾æ ‡ï¼ˆå¯é€‰ï¼Œemoji æˆ–ç•™ç©ºï¼‰</label>
            <input class="form-control" type="text" name="icon" placeholder="ğ• / G / ğŸ”‘">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Client ID</label>
            <input class="form-control" type="text" name="client_id" required>
          </div>
          <div class="form-group">
            <label class="form-label">Client Secret</label>
            <input class="form-control" type="password" name="client_secret" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Issuer URL</label>
            <input class="form-control" type="url" name="issuer_url" placeholder="https://accounts.google.com" required>
          </div>
          <div class="form-group">
            <label class="form-label">Scopesï¼ˆç©ºæ ¼åˆ†éš”ï¼‰</label>
            <input class="form-control" type="text" name="scopes" value="openid email profile">
          </div>
        </div>
        <button class="btn btn-primary btn-sm" type="submit">æ·»åŠ </button>
      </form>
    </div>

    <details class="card" style="margin-bottom:1.5rem;cursor:pointer">
      <summary style="font-size:.9rem;font-weight:600;padding:.2rem 0">å¸¸è§é…ç½®ç¤ºä¾‹</summary>
      <div style="margin-top:1rem;font-size:.82rem;color:var(--text2);display:flex;flex-direction:column;gap:.8rem">
        <div>
          <strong style="color:var(--text)">X (x.com)</strong><br>
          Issuer: <code>https://twitter.com</code><br>
          Scopes: <code>openid email profile</code><br>
          Callback: <code>{{.Issuer}}/auth/oidc/twitter/callback</code>
        </div>
        <div>
          <strong style="color:var(--text)">Google</strong><br>
          Issuer: <code>https://accounts.google.com</code><br>
          Scopes: <code>openid email profile</code>
        </div>
        <div>
          <strong style="color:var(--text)">Keycloak / Authentik / Dex</strong><br>
          ä½¿ç”¨å„è‡ªçš„ OIDC Issuer åœ°å€ï¼Œä¾‹å¦‚ï¼š<code>https://auth.example.com/realms/master</code>
        </div>
      </div>
    </details>

    <div class="card">
      <table class="data-table">
        <thead>
          <tr>
            <th>åç§°</th>
            <th>Slug</th>
            <th>Issuer</th>
            <th>çŠ¶æ€</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          {{range .Data}}
          <tr>
            <td>{{if .Icon}}<span style="margin-right:.4rem">{{.Icon}}</span>{{end}}{{.Name}}</td>
            <td><code style="font-size:.8rem;color:var(--blue)">/auth/oidc/{{.Slug}}</code></td>
            <td style="font-size:.8rem;max-width:220px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">{{.IssuerURL}}</td>
            <td>
              {{if .Enabled}}
              <span style="color:#16a34a;font-size:.82rem">å·²å¯ç”¨</span>
              {{else}}
              <span style="color:var(--text2);font-size:.82rem">å·²åœç”¨</span>
              {{end}}
            </td>
            <td style="white-space:nowrap">
              <form method="POST" action="/admin/providers/{{.ID}}/toggle" style="display:inline-block">
                <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
                <button class="btn btn-ghost btn-sm" type="submit">
                  {{if .Enabled}}åœç”¨{{else}}å¯ç”¨{{end}}
                </button>
              </form>
              <form method="POST" action="/admin/providers/{{.ID}}/delete" style="display:inline-block;margin-left:.4rem">
                <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
                <button class="btn btn-danger btn-sm" type="submit"
                  data-confirm="ç¡®è®¤åˆ é™¤æ­¤ç™»å½•æ–¹å¼å—ï¼Ÿä½¿ç”¨è¯¥æ–¹å¼ç™»å½•çš„ç”¨æˆ·å°†æ— æ³•ç»§ç»­ä½¿ç”¨ã€‚"
                  data-confirm-title="åˆ é™¤ç™»å½•æ–¹å¼" data-confirm-icon="ğŸ—‘ï¸">åˆ é™¤</button>
              </form>
            </td>
          </tr>
          {{else}}
          <tr><td colspan="5" style="color:var(--text2);text-align:center;padding:2rem">å°šæœªé…ç½®ä»»ä½•å¤–éƒ¨ç™»å½•æä¾›å•†</td></tr>
          {{end}}
        </tbody>
      </table>
    </div>
  </main>
</div>
{{end}}
