{{template "base" .}}

{{define "content"}}
<div class="panel-wrap">
  <aside class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-title">管理导航</div>
      {{if .CurrentUser.IsAdmin}}
      <a class="sidebar-link" href="/admin">概览</a>
      <a class="sidebar-link" href="/admin/users">用户</a>
      {{end}}
      <a class="sidebar-link" href="/admin/groups">分组</a>
      <a class="sidebar-link active" href="/admin/clients">应用</a>
      {{if .CurrentUser.IsAdmin}}
      <a class="sidebar-link" href="/admin/providers">登录方式</a>
      <a class="sidebar-link" href="/admin/roles">角色</a>
      <a class="sidebar-link" href="/admin/announcements">公告</a>
      <a class="sidebar-link" href="/admin/settings">设置</a>
      {{end}}
    </div>
    <div class="sidebar-section">
      <div class="sidebar-title">快速入口</div>
      <a class="sidebar-link" href="/">返回首页</a>
      <a class="sidebar-link" href="/profile">个人资料</a>
      <a class="sidebar-link" href="/member/projects">社区项目</a>
    </div>
  </aside>

  <main class="panel-content">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:.5rem">
      <h1 class="panel-title" style="margin:0">应用管理</h1>
      <a class="btn btn-primary btn-sm" href="/admin/clients/new">+ 新建应用</a>
    </div>
    <p class="panel-sub">管理授权登录应用。</p>

    {{if .Flash}}
    <div class="flash {{if .IsError}}flash-err{{else}}flash-ok{{end}}">{{.Flash}}</div>
    {{end}}

    <div class="card">
      <table class="data-table">
        <thead>
          <tr>
            <th>名称</th>
            <th>应用标识</th>
            <th>权限范围</th>
            <th>回调地址列表</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          {{with .Data}}
          {{range .Clients}}
          <tr>
            <td><a href="/admin/clients/{{.ID}}" style="font-weight:500">{{.Name}}</a></td>
            <td><code class="mono" style="color:var(--blue-d)">{{.ClientID}}</code></td>
            <td style="font-size:.8rem">{{range .Scopes}}<span class="proj-tag">{{.}}</span> {{end}}</td>
            <td style="font-size:.8rem;max-width:240px;overflow:hidden;text-overflow:ellipsis">
              {{range .RedirectURIs}}<div style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis">{{.}}</div>{{end}}
            </td>
            <td>
              <a class="btn btn-ghost btn-sm" href="/admin/clients/{{.ID}}">管理</a>
            </td>
          </tr>
          {{else}}
          <tr><td colspan="5" style="color:var(--text2);text-align:center;padding:2rem">暂无应用，点击右上角新建</td></tr>
          {{end}}
          {{end}}
        </tbody>
      </table>
    </div>
  </main>
</div>
{{end}}
