{{template "base" .}}

{{define "content"}}
<div class="auth-page" style="margin-top:0;min-height:100vh">
  <div class="auth-card">
    <div class="auth-logo">
      <div class="auth-logo-text">{{.SiteName}}</div>
    </div>
    <h2 class="auth-title">保护你的账户安全</h2>
    <p style="font-size:.88rem;color:var(--text2);margin-bottom:1.2rem;text-align:center">
      继续之前，请先设置新密码，或至少注册一个通行密钥。
    </p>

    {{if .Flash}}
    <div class="flash {{if .IsError}}flash-err{{else}}flash-ok{{end}}">{{.Flash}}</div>
    {{end}}

    <form method="POST" action="/profile/change-password">
      <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
      {{with .Data}}{{if .Next}}<input type="hidden" name="next" value="{{.Next}}">{{end}}{{end}}
      <div class="form-group">
        <label class="form-label">新密码（至少 8 位）</label>
        <input class="form-control" type="password" name="new_password" minlength="8" required autofocus>
      </div>
      <div class="form-group">
        <label class="form-label">确认新密码</label>
        <input class="form-control" type="password" name="confirm_password" minlength="8" required>
      </div>
      <button class="btn btn-primary" style="width:100%;justify-content:center;margin-top:.5rem" type="submit">
        更新密码
      </button>
    </form>

    <div class="divider">或</div>
    <p style="font-size:.86rem;color:var(--text2);margin-bottom:.7rem;text-align:left">
      注册通行密钥，保持无密码登录。
    </p>
    <div style="display:flex;gap:.6rem;align-items:center;flex-wrap:wrap">
      <input class="form-control" type="text" id="passkey-name" placeholder="通行密钥名称（可选）" style="flex:1">
      <button id="passkey-register-btn" class="btn btn-ghost btn-sm" type="button">注册通行密钥</button>
    </div>
    <div id="passkey-register-msg"></div>
  </div>
</div>
{{end}}
