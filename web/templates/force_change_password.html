{{template "base" .}}

{{define "content"}}
<div class="auth-page" style="margin-top:0;min-height:100vh">
  <div class="auth-card">
    <div class="auth-logo">
      <div class="auth-logo-text">{{.SiteName}}</div>
    </div>
    <h2 class="auth-title">Secure Your Account</h2>
    <p style="font-size:.88rem;color:var(--text2);margin-bottom:1.2rem;text-align:center">
      Before continuing, set a new password or register at least one passkey.
    </p>

    {{if .Flash}}
    <div class="flash {{if .IsError}}flash-err{{else}}flash-ok{{end}}">{{.Flash}}</div>
    {{end}}

    <form method="POST" action="/profile/change-password">
      <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
      <div class="form-group">
        <label class="form-label">New Password (min 8 chars)</label>
        <input class="form-control" type="password" name="new_password" minlength="8" required autofocus>
      </div>
      <div class="form-group">
        <label class="form-label">Confirm New Password</label>
        <input class="form-control" type="password" name="confirm_password" minlength="8" required>
      </div>
      <button class="btn btn-primary" style="width:100%;justify-content:center;margin-top:.5rem" type="submit">
        Update Password
      </button>
    </form>

    <div class="divider">OR</div>
    <p style="font-size:.86rem;color:var(--text2);margin-bottom:.7rem;text-align:left">
      Register a passkey and keep passwordless sign-in.
    </p>
    <div style="display:flex;gap:.6rem;align-items:center;flex-wrap:wrap">
      <input class="form-control" type="text" id="passkey-name" placeholder="Passkey name (optional)" style="flex:1">
      <button id="passkey-register-btn" class="btn btn-ghost btn-sm" type="button">Register Passkey</button>
    </div>
    <div id="passkey-register-msg"></div>
  </div>
</div>
{{end}}
