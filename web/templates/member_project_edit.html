{{template "base" .}}

{{define "content"}}
<div class="panel-wrap">
  <aside class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-title">成员导航</div>
      <a class="sidebar-link active" href="/member/projects">项目管理</a>
      <a class="sidebar-link" href="/member/links">友情链接</a>
      <a class="sidebar-link" href="/member/users">用户管理</a>
      {{if .CurrentUser}}{{if .CurrentUser.IsAdmin}}<a class="sidebar-link" href="/admin">管理后台</a>{{end}}{{end}}
    </div>
    <div class="sidebar-section">
      <div class="sidebar-title">快速入口</div>
      <a class="sidebar-link" href="/">返回首页</a>
    </div>
  </aside>

  <main class="panel-content">
    <h1 class="panel-title">编辑项目</h1>
    <p class="panel-sub">修改项目信息并保存。</p>

    {{if .Flash}}
    <div class="flash {{if .IsError}}flash-err{{else}}flash-ok{{end}}">{{.Flash}}</div>
    {{end}}

    {{with .Data}}
    <form class="form-panel" method="POST" action="/member/projects/{{.ID}}/edit">
      <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">项目代号</label>
          <input class="form-control" type="text" name="slug" value="{{.Slug}}" required>
        </div>
        <div class="form-group">
          <label class="form-label">中文名</label>
          <input class="form-control" type="text" name="name_zh" value="{{.NameZH}}">
        </div>
        <div class="form-group">
          <label class="form-label">英文名</label>
          <input class="form-control" type="text" name="name_en" value="{{.NameEN}}">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">中文简介</label>
          <textarea class="form-control" name="desc_zh" rows="3">{{.DescZH}}</textarea>
        </div>
        <div class="form-group">
          <label class="form-label">英文简介</label>
          <textarea class="form-control" name="desc_en" rows="3">{{.DescEN}}</textarea>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">状态</label>
          <select class="form-control" name="status">
            <option value="active" {{if eq .Status "active"}}selected{{end}}>进行中</option>
            <option value="planning" {{if eq .Status "planning"}}selected{{end}}>规划中</option>
            <option value="completed" {{if eq .Status "completed"}}selected{{end}}>已完成</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">项目链接</label>
          <input class="form-control" type="url" name="url" value="{{.URL}}">
        </div>
        <div class="form-group">
          <label class="form-label">标签（数组格式）</label>
          <input class="form-control" type="text" name="tags" value="{{.Tags}}">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">排序值</label>
          <input class="form-control" type="number" name="sort_order" value="{{.SortOrder}}">
        </div>
        <div class="form-group">
          <label class="form-label">是否置顶</label>
          <select class="form-control" name="featured">
            <option value="0" {{if eq .Featured false}}selected{{end}}>否</option>
            <option value="1" {{if .Featured}}selected{{end}}>是</option>
          </select>
        </div>
      </div>

      <div style="display:flex;gap:.6rem">
        <button class="btn btn-primary btn-sm" type="submit">保存修改</button>
        <a class="btn btn-ghost btn-sm" href="/member/projects">返回列表</a>
      </div>
    </form>

    <div class="form-panel" style="margin-top:1.5rem">
      <p class="form-panel-title">项目图片</p>
      {{if .ImageURL}}
      <div style="margin-bottom:1rem">
        <img src="{{.ImageURL}}" alt="项目图片" style="max-width:100%;max-height:240px;border-radius:8px;border:1px solid rgba(0,0,0,0.08)">
      </div>
      {{end}}
      <form method="POST" action="/member/projects/{{.ID}}/upload-image" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">上传图片（PNG/JPEG，最大1MB）</label>
            <input class="form-control" type="file" name="image_file" accept="image/png,image/jpeg" required>
          </div>
        </div>
        <button class="btn btn-primary btn-sm" type="submit">上传图片</button>
      </form>
    </div>
    {{end}}
  </main>
</div>
{{end}}
